ggplot(aes(x = Date, y = n, color = Origin, group = Origin)) +
stat_smooth(n = 1000, span = 10.01, se = TRUE)
SanFran_flights %>%
filter(Origin %in% c("SFO", "OAK")) %>%
count(Week, Origin) %>%
mutate(Date = Week,
n = n * sample.weight.int) %>%  # sample
ggplot(aes(x = Date, y = n, color = Origin, group = Origin)) +
stat_smooth(n = 100, span = 10.01, se = TRUE)
SanFran_flights %>%
filter(Origin %in% c("SFO", "OAK")) %>%
count(Week, Origin) %>%
mutate(Date = Week,
n = n * sample.weight.int) %>%  # sample
ggplot(aes(x = Date, y = n, color = Origin, group = Origin)) +
stat_smooth(n = 10000, span = 0.01, se = TRUE)
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK")) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n * sample.weight.int) %>%  # sample
ggplot(aes(x = Date, y = n, color = Origin, group = Origin)) +
geom_line()
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK")) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n * sample.weight.int) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK")) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK"))
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK")) %>%
count(Week, SF_airport)
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == "SFO", "SFO", "OAK")) %>%
print
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == c("SFO", "OAK"),
Origin,
Dest) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin == c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
SanFran_flights %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
source('~/.active-rstudio-document', echo=TRUE)
setwd("C:/US_flight_data/data-raw/US-flight-data")
source('~/.active-rstudio-document', echo=TRUE)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_line()
stat_smooth(n = 10000, span = 0.01, se = TRUE)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
mutate(Date = Week,
n = n) %>%  # sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5)
unique_dates
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
merge(unique_dates, by.x = "Week", by.y = "Week")
setkey(unique_dates, Week)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
merge(unique_dates)
gc(1,1)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique_dates, by = "Week")
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport)
unique_dates
unique_dates %>% str
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique_dates, by = "Week", all.x = TRUE)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates))
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates))
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth)),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5)
setkey(unique_dates, Week)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates)) %>%
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth)),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5)
setkey(unique_dates, Week)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates)) %>%
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth)),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5) +
#
geom_vline(xintercept = fastPOSIXct("2001-09-11"))
fastPOSIXct("2001-09-11")
str(fastPOSIXct("2001-09-11"))
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates)) %>%
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth), tz = "GMT"),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5) +
#
geom_vline(xintercept = fastPOSIXct("2001-09-11", tz = "GMT"))
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates)) %>%
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth), tz = "GMT"),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5) +
#
geom_vline(xintercept = as.POSIXct("2001-09-11"))
setkey(unique_dates, Week)
flightsSanFran %>%
filter(!(Origin %in% c("SFO", "OAK") & Dest %in% c("SFO", "OAK"))) %>%
mutate(SF_airport = ifelse(Origin %in% c("SFO", "OAK"),
Origin,
Dest)) %>%
count(Week, SF_airport) %>%
setkey(Week) %>%
data.table:::merge.data.table(unique(unique_dates)) %>%
mutate(Date = fastPOSIXct(sprintf("%d-%02d-%02d", Year, Month, DayofMonth), tz = "GMT"),
n = n) %>%  # not a sample
ggplot(aes(x = Date, y = n, color = SF_airport, group = SF_airport)) +
geom_point() +
geom_line(size = 0.5) +
#
geom_vline(xintercept = as.numeric(as.POSIXct("2001-09-11")))
rm(list = ls())
gc(1,1)
setwd("C:/US_flight_data/data-raw/US-flight-data")
source('~/.active-rstudio-document', echo=TRUE)
library(pryr)
object_size(flights)
flights %>%
count(UniqueCarrier, Year) %>%
ggplot(aes(x = Year, y = n, color = UniqueCarrier, group = UniqueCarrier)) +
geom_line()
top_5_carriers <-
flights %>%
count(UniqueCarrier)
top_5_carriers[order(-n), # your data is already sorted, so this does nothing for it
if (.BY[[1]]) .SD else list("Other", sum(n)),
by = 1:nrow(dt) <= 5][, !"nrow", with = F]
top_5_carriers[order(-n), # your data is already sorted, so this does nothing for it
if (.BY[[1]]) .SD else list("Other", sum(n)),
by = 1:nrow(top_5_carriers) <= 5][, !"nrow", with = F]
top_5_carriers <-
flights %>%
count(UniqueCarrier)
top_5_carriers[order(-n), # your data is already sorted, so this does nothing for it
if (.BY[[1]]) .SD else list("Other", sum(n)),
by = 1:nrow(top_5_carriers) <= 7][, !"nrow", with = F]
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(Carrier_other = ifelse(1:n() <= 5, UniqueCarrier, "Other"))
top_5_carriers
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(Carrier_other = ifelse(1:n() <= 5, UniqueCarrier, "Other")) %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
count(UniqueCarrier, Year) %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line()
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line()
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(Carrier_other = ifelse(1:n() <= 6, UniqueCarrier, "Other")) %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line()
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(Carrier_other = ifelse(1:n() <= 7, UniqueCarrier, "Other")) %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line()
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(TopN = 1:n() <= 5) %>%
mutate(Carrier_other = TopN, UniqueCarrier, "Other") %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
facet_grid(TopN ~ .)
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(TopN = 1:n() <= 5) %>%
mutate(Carrier_other = TopN, UniqueCarrier, "Other") %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
mutate(TopN = Carrier_other != "Other") %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
facet_grid(TopN ~ .)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
mutate(TopN = Carrier_other != "Other")
top_5_carriers <-
flights %>%
count(UniqueCarrier) %>%
arrange(desc(n)) %>%
mutate(TopN = 1:n() <= 5) %>%
mutate(Carrier_other = ifelse(TopN, UniqueCarrier, "Other")) %>%
select(-n) %>%
setkey(UniqueCarrier)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year)  %>%
mutate(TopN = Carrier_other != "Other") %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
facet_grid(TopN ~ .)
?scale_color_manual
?scale_color_discrete
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year) %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
scale_colour_hue("clarity")
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year) %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
scale_colour_brewer(palette = "Accent")
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year) %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
scale_colour_brewer(palette = "Accent") +
scale_y_continuous(label = comma)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year) %>%
ggplot(aes(x = Year, y = n, color = Carrier_other, group = Carrier_other)) +
geom_line() +
scale_colour_brewer(palette = "Accent") +
scale_y_continuous(label = scales::comma)
flights %>%
setkey(UniqueCarrier) %>%
merge(top_5_carriers) %>%
count(Carrier_other, Year) %>%
ggplot(aes(x = Year, y = n * sample.weight.int, color = Carrier_other, group = Carrier_other)) +
geom_line() +
scale_colour_brewer(palette = "Accent") +
scale_y_continuous(label = scales::comma)
?brewer.pal
flights %>%
count(Dest) %>%
arrange(desc(n))
flights[,n := .N, keyby = Dest]
flights
flights[,n:=NULL]
flights[,.(n := .N), by = Dest]
is.data.table(flights)
key(flights)
flights[,.(n := .N), by = Dest]
flights[,.(n = .N), by = Dest]
microbenchmark::microbenchmark(flights[,.(n = .N), by = Dest], {flights %>% count(Dest)}, times = 10L)
flights[,.(n = .N), by = Dest][keyby = n]
flights[,.(n = .N), by = Dest][,,keyby = n]
setkey(flights[,.(n = .N), by = Dest], n)
flights[order(-n),.(n = .N), by = Dest]
flights[ ,.(n = .N), by = Dest][order(n)]
flights[ ,.(n = .N), by = Dest][order(-n)]
flights[ ,.(n = .N), by = Dest][order(-n)] # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport"))
flights[ ,.(n = .N), by = Dest][order(-n)] %>% # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport"))
major_airports <-
flights[ ,.(n = .N), by = Dest][order(-n)] %>% # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport"))
major_airports
print(major_airports)
flights[ ,.(n = .N), by = list(Year, Dest)][major_airports]
major_airports <-
flights[ ,.(n = .N), by = Dest][order(-n)] %>% # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport")) %>%
setkey(Dest)
flights[ ,.(n = .N), by = list(Year, Dest)][major_airports]
major_airports <-
flights[ ,.(n = .N), by = Dest][order(-n)] %>% # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport")) %>%
setkey(Dest)
setkey(flights, Dest)
flights[ ,.(n = .N), by = list(Year, Dest)][major_airports]
flights[ ,.(n = .N), by = list(Year, Dest)] %>%
merge(major_airports)
flights[ ,.(n = .N), by = list(Year, Dest)] %>%
merge(major_airports, by = "Dest")
flights[ ,.(n = .N * sample.weight.int), by = list(Year, Dest)] %>%
merge(major_airports, by = "Dest") %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
major_airports <-
flights[ ,.(n = .N), by = Dest][order(-n)] %>% # flights %>% count(Dest) %>% arrange(desc(n))
mutate(TopN = 1:n() <= 10) %>%
mutate(AirportOther = ifelse(TopN, Dest, "Other_airport")) %>%
select(-n) %>%
setkey(Dest)
setkey(flights, Dest)
flights[ ,.(n = .N * sample.weight.int), by = list(Year, Dest)] %>%
merge(major_airports, by = "Dest") %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)]
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line() +
facet_grid(AirportOther == "Other_airport" ~ ., scale_y = "free")
?facet_frid
?facet_grid
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line() +
facet_grid(AirportOther == "Other_airport" ~ ., scales = "free_y")
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
filter(AirportOther != "Other_airport") %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
filter(AirportOther != "Other_airport", Year > 1987L) %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
flights[major_airports][ ,.(n = .N * sample.weight.int), by = list(Year, AirportOther)] %>%
filter(AirportOther != "Other_airport", Year > 1987L, Year < 2015L) %>%
ggplot(aes(x = Year, y = n, group = AirportOther, color = AirportOther)) +
geom_line()
